<!DOCTYPE html>
<html lang="zh-TW">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="google-site-verification"
            content="f9zVd6O3yQY_bfVrwDJRDh0ITJyaC1tYhV4CsYDnCv4"
        />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="images/apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="images/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="images/favicon-16x16.png"
        />
        <link rel="manifest" href="images/site.webmanifest" />
        <link rel="shortcut icon" href="images/favicon.ico" />
        <title>學習單字生成器</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            :root {
                --bg-gradient: linear-gradient(
                    135deg,
                    #667eea 0%,
                    #764ba2 100%
                );
                --card-bg: rgba(255, 255, 255, 0.95);
                --text-primary: #2d3748;
                --text-secondary: #4a5568;
                --border-color: #e2e8f0;
                --input-bg: #ffffff;
                --button-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                --button-hover: linear-gradient(
                    135deg,
                    #5a6fd8 0%,
                    #6b4190 100%
                );
                --success-color: #48bb78;
                --error-color: #f56565;
                --warning-color: #ecc94b;
                --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
                    0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }

            [data-theme='dark'] {
                --bg-gradient: linear-gradient(
                    135deg,
                    #1a202c 0%,
                    #2d3748 100%
                );
                --card-bg: rgba(45, 55, 72, 0.95);
                --text-primary: #f7fafc;
                --text-secondary: #cbd5e0;
                --border-color: #4a5568;
                --input-bg: #2d3748;
                --button-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                --button-hover: linear-gradient(
                    135deg,
                    #5a6fd8 0%,
                    #6b4190 100%
                );
                --success-color: #68d391;
                --error-color: #fc8181;
                --warning-color: #faf089;
                --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3),
                    0 10px 10px -5px rgba(0, 0, 0, 0.2);
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: var(--bg-gradient);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                transition: all 0.3s ease;
            }

            .container {
                background: var(--card-bg);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                box-shadow: var(--shadow);
                padding: 40px;
                width: 100%;
                max-width: 500px;
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .container::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--button-bg);
            }

            .header {
                text-align: center;
                margin-bottom: 40px;
            }

            .header h1 {
                color: var(--text-primary);
                font-size: 2rem;
                font-weight: 700;
                margin-bottom: 10px;
                background: var(--button-bg);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .header p {
                color: var(--text-secondary);
                font-size: 1rem;
                opacity: 0.8;
            }

            .theme-toggle {
                position: absolute;
                top: 20px;
                right: 20px;
                background: var(--input-bg);
                border: 1px solid var(--border-color);
                border-radius: 50%;
                width: 50px;
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 1.5rem;
            }

            .theme-toggle:hover {
                transform: scale(1.1);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

            .form-group {
                margin-bottom: 30px;
            }

            .form-label {
                display: block;
                color: var(--text-primary);
                font-weight: 600;
                margin-bottom: 8px;
                font-size: 0.95rem;
            }

            .form-input,
            .form-textarea {
                width: 100%;
                padding: 16px 20px;
                border: 2px solid var(--border-color);
                border-radius: 12px;
                font-size: 1rem;
                background: var(--input-bg);
                color: var(--text-primary);
                transition: all 0.3s ease;
                resize: vertical;
            }

            .form-input:focus,
            .form-textarea:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                transform: translateY(-2px);
            }

            .form-textarea {
                min-height: 120px;
                font-family: inherit;
            }

            .submit-button {
                width: 100%;
                padding: 16px;
                background: var(--button-bg);
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .submit-button:hover {
                background: var(--button-hover);
                transform: translateY(-2px);
                box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
            }

            .submit-button:active {
                transform: translateY(0);
            }

            .submit-button:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            .loading-spinner {
                display: none;
                width: 20px;
                height: 20px;
                border: 2px solid transparent;
                border-top: 2px solid white;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-right: 10px;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .progress-container {
                display: none;
                margin-top: 20px;
                padding: 20px;
                background: rgba(102, 126, 234, 0.1);
                border-radius: 12px;
                border: 1px solid rgba(102, 126, 234, 0.3);
            }

            .progress-bar {
                width: 100%;
                height: 8px;
                background: rgba(102, 126, 234, 0.2);
                border-radius: 4px;
                overflow: hidden;
                margin-bottom: 15px;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #667eea, #764ba2);
                border-radius: 4px;
                width: 0%;
                transition: width 0.3s ease;
                animation: shimmer 2s infinite;
            }

            @keyframes shimmer {
                0% {
                    background-position: -200px 0;
                }
                100% {
                    background-position: 200px 0;
                }
            }

            .progress-text {
                text-align: center;
                color: var(--text-primary);
                font-weight: 500;
                margin-bottom: 10px;
            }

            .progress-steps {
                display: flex;
                justify-content: space-between;
                margin-top: 15px;
            }

            .progress-step {
                display: flex;
                flex-direction: column;
                align-items: center;
                flex: 1;
                font-size: 0.8rem;
                color: var(--text-secondary);
            }

            .progress-step.active {
                color: #667eea;
                font-weight: 600;
            }

            .step-icon {
                width: 24px;
                height: 24px;
                border-radius: 50%;
                background: rgba(102, 126, 234, 0.2);
                display: flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 5px;
                font-size: 0.7rem;
            }

            .progress-step.active .step-icon {
                background: #667eea;
                color: white;
            }

            .tips-container {
                margin-top: 15px;
                padding: 15px;
                background: rgba(72, 187, 120, 0.1);
                border-radius: 8px;
                border-left: 4px solid #48bb78;
            }

            .tips-title {
                font-weight: 600;
                color: var(--success-color);
                margin-bottom: 8px;
                display: flex;
                align-items: center;
            }

            .tips-content {
                color: var(--text-secondary);
                font-size: 0.9rem;
                line-height: 1.5;
            }

            .message {
                padding: 16px;
                border-radius: 12px;
                margin-top: 20px;
                font-weight: 500;
                display: none;
                animation: slideIn 0.3s ease;
            }

            .message.success {
                background: rgba(72, 187, 120, 0.1);
                color: var(--success-color);
                border: 1px solid rgba(72, 187, 120, 0.3);
            }

            .message.error {
                background: rgba(245, 101, 101, 0.1);
                color: var(--error-color);
                border: 1px solid rgba(245, 101, 101, 0.3);
            }

            .result-container {
                display: none;
                margin-top: 20px;
                padding: 20px;
                background: rgba(102, 126, 234, 0.1);
                border-radius: 12px;
                border: 1px solid rgba(102, 126, 234, 0.3);
            }

            .result-title {
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                font-size: 1.1rem;
            }

            .result-content {
                color: var(--text-secondary);
                line-height: 1.6;
            }

            .new-request-button {
                padding: 10px 20px;
                background: var(--input-bg);
                color: var(--text-primary);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                font-size: 0.9rem;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-top: 15px;
            }

            .new-request-button:hover {
                background: var(--border-color);
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .floating-elements {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: -1;
            }

            .floating-element {
                position: absolute;
                width: 8px;
                height: 8px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 50%;
                animation: float 6s ease-in-out infinite;
            }

            @keyframes float {
                0%,
                100% {
                    transform: translateY(0px) rotate(0deg);
                }
                50% {
                    transform: translateY(-20px) rotate(180deg);
                }
            }

            /* 響應式設計 */
            @media (max-width: 768px) {
                .container {
                    padding: 30px 20px;
                    margin: 10px;
                    border-radius: 16px;
                }

                .header h1 {
                    font-size: 1.75rem;
                }

                .theme-toggle {
                    width: 45px;
                    height: 45px;
                    font-size: 1.3rem;
                }

                .form-input,
                .form-textarea,
                .submit-button {
                    padding: 14px 16px;
                }

                .form-textarea {
                    min-height: 100px;
                }
            }

            @media (max-width: 480px) {
                body {
                    padding: 10px;
                }

                .container {
                    padding: 25px 15px;
                }

                .header h1 {
                    font-size: 1.5rem;
                }

                .header p {
                    font-size: 0.9rem;
                }
            }
        </style>
    </head>
    <body>
        <div class="floating-elements">
            <div
                class="floating-element"
                style="left: 10%; animation-delay: 0s"
            ></div>
            <div
                class="floating-element"
                style="left: 20%; animation-delay: 2s"
            ></div>
            <div
                class="floating-element"
                style="left: 30%; animation-delay: 4s"
            ></div>
            <div
                class="floating-element"
                style="left: 40%; animation-delay: 1s"
            ></div>
            <div
                class="floating-element"
                style="left: 50%; animation-delay: 3s"
            ></div>
            <div
                class="floating-element"
                style="left: 60%; animation-delay: 5s"
            ></div>
            <div
                class="floating-element"
                style="left: 70%; animation-delay: 2.5s"
            ></div>
            <div
                class="floating-element"
                style="left: 80%; animation-delay: 4.5s"
            ></div>
            <div
                class="floating-element"
                style="left: 90%; animation-delay: 1.5s"
            ></div>
        </div>

        <div class="container">
            <div class="theme-toggle" onclick="toggleTheme()">
                <span id="themeIcon">🌙</span>
            </div>

            <div class="header">
                <h1>學習單字生成器</h1>
                <p>輸入您的學習情境，獲取個人化單字推薦</p>
            </div>

            <form id="learningForm">
                <div class="form-group">
                    <label for="email" class="form-label">📧 電子郵件</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        class="form-input"
                        placeholder="請輸入您的電子郵件地址"
                        required
                    />
                </div>

                <div class="form-group">
                    <label for="situation" class="form-label"
                        >📚 學習情境</label
                    >
                    <textarea
                        id="situation"
                        name="situation"
                        class="form-textarea"
                        placeholder="例如：請給我去逛街會用到的5個單字"
                        required
                    ></textarea>

                    <div
                        class="tips-container"
                        id="usageTips"
                        style="
                            margin-top: 10px;
                            border-left-color: var(--warning-color);
                            background: rgba(236, 201, 75, 0.1);
                        "
                    >
                        <div
                            class="tips-title"
                            style="color: var(--warning-color)"
                        >
                            ⚠️ 使用建議
                        </div>
                        <div
                            class="tips-content"
                            style="
                                color: var(--text-secondary);
                                font-size: 0.85rem;
                            "
                        >
                            建議每次請求的單字數量控制在
                            <strong>5～10 個</strong>
                            以內，避免一次生成太多單字，以免影響 AI
                            分析品質與學習效果。
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-button">
                    <span class="loading-spinner" id="loadingSpinner"></span>
                    <span id="buttonText">🚀 生成學習單字</span>
                </button>
            </form>

            <div id="message" class="message"></div>

            <div id="progressContainer" class="progress-container">
                <div class="progress-text" id="progressText">
                    正在處理您的請求...
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-steps">
                    <div class="progress-step active" id="step1">
                        <div class="step-icon">1</div>
                        <span>接收請求</span>
                    </div>
                    <div class="progress-step" id="step2">
                        <div class="step-icon">2</div>
                        <span>AI 分析</span>
                    </div>
                    <div class="progress-step" id="step3">
                        <div class="step-icon">3</div>
                        <span>生成單字</span>
                    </div>
                    <div class="progress-step" id="step4">
                        <div class="step-icon">4</div>
                        <span>發送郵件</span>
                    </div>
                </div>
                <div class="tips-container">
                    <div class="tips-title">💡 小提示</div>
                    <div class="tips-content" id="tipsContent">
                        我們的 AI
                        正在仔細分析您的學習情境，為您挑選最合適的單字...
                    </div>
                </div>
            </div>

            <div id="resultContainer" class="result-container">
                <div class="result-title" id="resultTitle">
                    ✅ 學習單字已生成！
                </div>
                <div class="result-content" id="resultContent">
                    您的學習單字已成功生成並發送到您的信箱，請查收！
                </div>
            </div>
        </div>

        <script>
            // 主題切換功能
            function toggleTheme() {
                const body = document.body;
                const themeIcon = document.getElementById('themeIcon');
                const currentTheme = body.getAttribute('data-theme');

                if (currentTheme === 'dark') {
                    body.removeAttribute('data-theme');
                    themeIcon.textContent = '🌙';
                    localStorage.setItem('theme', 'light');
                } else {
                    body.setAttribute('data-theme', 'dark');
                    themeIcon.textContent = '☀️';
                    localStorage.setItem('theme', 'dark');
                }
            }

            // 初始化主題
            function initTheme() {
                const savedTheme = localStorage.getItem('theme');
                const themeIcon = document.getElementById('themeIcon');

                if (savedTheme === 'dark') {
                    document.body.setAttribute('data-theme', 'dark');
                    themeIcon.textContent = '☀️';
                } else {
                    themeIcon.textContent = '🌙';
                }
            }

            // Email 記憶功能
            function saveEmailToLocalStorage(email) {
                localStorage.setItem('userEmail', email);
            }

            function loadEmailFromLocalStorage() {
                return localStorage.getItem('userEmail');
            }

            // 進度條控制
            let progressInterval;
            let currentStep = 0;

            const progressSteps = [
                {
                    text: '正在接收您的請求...',
                    tip: '我們已收到您的學習需求，正在建立連接...',
                },
                {
                    text: 'AI 正在深度分析您的情境...',
                    tip: '我們的 AI 正在理解您的學習場景，分析最適合的詞彙類型...',
                },
                {
                    text: '智慧生成個人化單字...',
                    tip: '基於您的情境，AI 正在從詞庫中挑選最實用的單字...',
                },
                {
                    text: '準備發送到您的信箱...',
                    tip: '單字生成完成！正在整理格式並發送到您的電子郵件...',
                },
            ];

            function startProgress() {
                const progressContainer =
                    document.getElementById('progressContainer');
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                const tipsContent = document.getElementById('tipsContent');
                const usageTips = document.getElementById('usageTips');

                // 隱藏使用提示
                usageTips.style.display = 'none';

                progressContainer.style.display = 'block';
                currentStep = 0;

                // 立即開始第一步
                updateProgressStep();

                // 每30秒更新一次進度
                progressInterval = setInterval(() => {
                    if (currentStep < progressSteps.length - 1) {
                        currentStep++;
                        updateProgressStep();
                    }
                }, 30000);
            }

            function updateProgressStep() {
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                const tipsContent = document.getElementById('tipsContent');

                // 更新進度條
                const progressPercent =
                    ((currentStep + 1) / progressSteps.length) * 100;
                progressFill.style.width = `${progressPercent}%`;

                // 更新文字
                progressText.textContent = progressSteps[currentStep].text;
                tipsContent.textContent = progressSteps[currentStep].tip;

                // 更新步驟指示器
                document
                    .querySelectorAll('.progress-step')
                    .forEach((step, index) => {
                        if (index <= currentStep) {
                            step.classList.add('active');
                        } else {
                            step.classList.remove('active');
                        }
                    });
            }

            function stopProgress() {
                if (progressInterval) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
                document.getElementById('progressContainer').style.display =
                    'none';
            }

            // 顯示結果
            function showResult(success = true, message = '') {
                const resultContainer =
                    document.getElementById('resultContainer');
                const resultTitle = document.getElementById('resultTitle');
                const resultContent = document.getElementById('resultContent');
                const usageTips = document.getElementById('usageTips');

                if (success) {
                    resultTitle.style.display = 'block';
                    resultTitle.innerHTML = '✅ 學習單字已生成！';
                    resultContent.innerHTML =
                        message ||
                        '您的學習單字已成功生成並發送到您的信箱，請查收！';
                } else {
                    resultTitle.style.display = 'none';
                    resultContent.innerHTML = `<span style="color: var(--error-color)">${
                        message || '生成過程中出現錯誤，請稍後再試。'
                    }</span>`;
                }

                resultContainer.style.display = 'block';
                usageTips.style.display = 'none';

                // 添加新請求功能
                document.getElementById('newRequestButton').onclick =
                    function () {
                        resultContainer.style.display = 'none';
                        usageTips.style.display = 'block';
                        document.getElementById('situation').value = '';
                        document.getElementById('situation').focus();
                    };
            }

            // 顯示訊息
            function showMessage(text, type) {
                const messageEl = document.getElementById('message');
                messageEl.textContent = text;
                messageEl.className = `message ${type}`;
                messageEl.style.display = 'block';

                // 只對錯誤訊息設置自動隱藏
                if (type === 'error') {
                    setTimeout(() => {
                        messageEl.style.display = 'none';
                    }, 5000);
                }
            }

            // 設定載入狀態
            function setLoading(isLoading) {
                const submitButton = document.querySelector('.submit-button');
                const loadingSpinner =
                    document.getElementById('loadingSpinner');
                const buttonText = document.getElementById('buttonText');

                if (isLoading) {
                    submitButton.disabled = true;
                    loadingSpinner.style.display = 'inline-block';
                    buttonText.textContent = '處理中...';
                } else {
                    submitButton.disabled = false;
                    loadingSpinner.style.display = 'none';
                    buttonText.textContent = '🚀 生成學習單字';
                }
            }

            // 表單提交處理
            document
                .getElementById('learningForm')
                .addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const email = document.getElementById('email').value.trim();
                    const situation = document
                        .getElementById('situation')
                        .value.trim();

                    // 驗證輸入
                    if (!email || !situation) {
                        showMessage('請填寫所有必填欄位', 'error');
                        return;
                    }

                    // 驗證電子郵件格式
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        showMessage('請輸入有效的電子郵件地址', 'error');
                        return;
                    }

                    // 保存email到localStorage
                    saveEmailToLocalStorage(email);

                    setLoading(true);
                    startProgress();

                    try {
                        const response = await fetch(
                            'https://learning-words.onrender.com/generateWord',
                            {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    Accept: 'application/json',
                                },
                                mode: 'cors', // 明確設定 CORS 模式
                                credentials: 'omit', // 不發送認證資訊
                                body: JSON.stringify({
                                    des: situation,
                                    user_email: email,
                                }),
                            }
                        );

                        if (response.ok) {
                            // 完成所有步驟
                            currentStep = progressSteps.length - 1;
                            updateProgressStep();

                            setTimeout(() => {
                                stopProgress();
                                showResult(
                                    true,
                                    '✅ 太棒了！學習單字已成功生成並發送到您的信箱，請查收！'
                                );
                                document.getElementById('situation').value = '';
                            }, 2000);
                        } else {
                            stopProgress();
                            const errorData = await response
                                .json()
                                .catch(() => ({}));
                            showResult(
                                false,
                                `❌ 請求失敗：${
                                    errorData.message ||
                                    '伺服器錯誤，請稍後再試'
                                }`
                            );
                        }
                    } catch (error) {
                        stopProgress();
                        console.error('Error:', error);

                        if (
                            error.name === 'TypeError' &&
                            error.message.includes('fetch')
                        ) {
                            showResult(
                                false,
                                '❌ 連接失敗：可能是跨域問題或網路不穩定。您可以嘗試：\n1. 重新整理頁面後再試\n2. 檢查網路連接\n3. 稍後再試'
                            );
                        } else {
                            showResult(
                                false,
                                '❌ 網路連接錯誤，請檢查您的網路連接後重試'
                            );
                        }
                    } finally {
                        setLoading(false);
                    }
                });

            // 動態調整浮動元素位置
            function randomizeFloatingElements() {
                const elements = document.querySelectorAll('.floating-element');
                elements.forEach((element) => {
                    const randomTop = Math.random() * 100;
                    const randomDelay = Math.random() * 6;
                    element.style.top = `${randomTop}%`;
                    element.style.animationDelay = `${randomDelay}s`;
                });
            }

            // 頁面載入完成後初始化
            document.addEventListener('DOMContentLoaded', function () {
                initTheme();
                randomizeFloatingElements();

                // 載入保存的email
                const savedEmail = loadEmailFromLocalStorage();
                if (savedEmail) {
                    document.getElementById('email').value = savedEmail;
                }

                // 每30秒重新隨機化浮動元素
                setInterval(randomizeFloatingElements, 30000);

                // 確保結果容器是隱藏的，提示是顯示的
                document.getElementById('resultContainer').style.display =
                    'none';
                document.getElementById('usageTips').style.display = 'block';
            });
        </script>
    </body>
</html>
